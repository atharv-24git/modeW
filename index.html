<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mood Analyzer — Gemini + Deepseak (Safe)</title>
  <style>
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;max-width:920px;margin:28px auto;padding:18px;color:#0b1220}
    h1{font-size:20px;margin-bottom:6px}
    label{display:block;margin:12px 0 6px}
    textarea{width:100%;min-height:120px;padding:10px;border-radius:8px;border:1px solid #ddd}
    input[type=text]{width:100%;padding:8px;border-radius:8px;border:1px solid #ddd}
    .row{display:flex;gap:12px}
    .col{flex:1}
    button{padding:10px 14px;border-radius:10px;border:0;background:#0b76ef;color:white;font-weight:600;cursor:pointer}
    .result{margin-top:16px;border-radius:8px;padding:14px;background:#fbfcff;border:1px solid #eef3ff}
    pre{white-space:pre-wrap;font-family:inherit}
    .provider-box{display:flex;gap:8px;align-items:center}
    .muted{color:#6b7280;font-size:13px}
  </style>
</head>
<body>
  <h1>Mood Analyzer — Gemini & Deepseak (Safe)</h1>
  <p class="muted">This frontend talks to a local proxy server (`/api/analyze`) which reads your API keys from the server `.env` file. Keep your `.env` secret.</p>

  <label for="inputText">Your text (amar likhe text):</label>
  <textarea id="inputText" placeholder="Paste the text you want Gemini & Deepseak to analyze..."></textarea>

  <label>Choose providers:</label>
  <div class="provider-box">
    <input type="checkbox" id="useGemini" checked>
    <label for="useGemini">Gemini</label>
    <input type="checkbox" id="useDeepseak" checked style="margin-left:10px">
    <label for="useDeepseak">Deepseak</label>
  </div>

  <label for="tone">Desired output tone (optional)</label>
  <input id="tone" type="text" placeholder="e.g. poetic, clinical, empathetic (default: empathetic)">

  <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
    <button id="analyzeBtn">Analyze</button>
    <button id="clearBtn" style="background:#e6e6e6;color:#111">Clear</button>
    <div class="muted" style="margin-left:8px">Result will appear below in a full-length structured format.</div>
  </div>

  <div id="output" class="result" aria-live="polite" style="display:none"></div>

  <script>
    function escapeHtml(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\"/g,'&quot;');}

    async function analyze(){
      const text = document.getElementById('inputText').value.trim();
      const useGem = document.getElementById('useGemini').checked;
      const useDeep = document.getElementById('useDeepseak').checked;
      const tone = document.getElementById('tone').value.trim() || 'empathetic';
      const output = document.getElementById('output');
      if(!text){ alert('Please paste the text you want analyzed.'); return; }
      if(!useGem && !useDeep){ alert('Select at least one provider.'); return; }

      output.style.display = 'block';
      output.innerHTML = '<em>Contacting local server…</em>';

      try{
        const res = await fetch('/api/analyze', {
          method: 'POST', headers: {'Content-Type':'application/json'},
          body: JSON.stringify({text, providers:{gemini:useGem, deepseak:useDeep}, tone})
        });
        if(!res.ok){ const t = await res.text(); throw new Error('Server error: '+t); }
        const json = await res.json();
        // Build full-length merged view
        let html = `<strong>Original text</strong><pre>${escapeHtml(text)}</pre><hr>`;
        for(const p of Object.keys(json)){
          html += `<h3>Analysis from ${escapeHtml(p)}</h3>`;
          html += `<pre>${escapeHtml(JSON.stringify(json[p], null, 2))}</pre><hr>`;
        }
        output.innerHTML = html;
      }catch(err){
        output.innerHTML = `<strong style=\"color:#b91c1c\">Error:</strong> ${escapeHtml(err.message||err)} `;
      }
    }

    document.getElementById('analyzeBtn').addEventListener('click', analyze);
    document.getElementById('clearBtn').addEventListener('click', ()=>{document.getElementById('inputText').value='';document.getElementById('output').style.display='none'});
  </script>
</body>
</html>