<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Æ‡ßÅ‡¶° ‡¶¨‡ßá‡¶∏‡¶° ‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï ‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .input-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            height: 100px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .result-section {
            display: none;
        }

        .music-list {
            margin-top: 20px;
        }

        .music-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .music-item:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }

        .music-icon {
            font-size: 24px;
            margin-right: 15px;
        }

        .music-info {
            flex: 1;
        }

        .music-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .music-platform {
            color: #666;
            font-size: 14px;
        }

        .play-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        .error-message {
            background: #ffeaa7;
            color: #d63031;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            display: none;
        }

        .api-key-section {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }

        .api-key-section h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .weather-analysis {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #2196f3;
        }

        .weather-analysis h3 {
            color: #1976d2;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .weather-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .weather-stat {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .weather-stat .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #1976d2;
        }

        .weather-stat .label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéµ ‡¶Æ‡ßÅ‡¶° ‡¶¨‡ßá‡¶∏‡¶° ‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï</h1>
            <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßÅ‡¶° ‡¶¶‡¶ø‡¶®, ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶™‡¶æ‡¶∞‡¶´‡ßá‡¶ï‡ßç‡¶ü ‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï ‡¶∏‡¶æ‡¶ú‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡¶¨</p>
        </div>

        <div class="api-key-section">
            <h3>‚ö†Ô∏è API Keys ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®</h3>
            <p>‡¶è‡¶á ‡¶ì‡¶Ø‡¶º‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü‡¶ü‡¶ø ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ API Keys ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®:</p>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li><strong>Gemini API:</strong> <a href="https://aistudio.google.com/app/apikey" target="_blank">‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶ø‡¶®</a> (Weather analysis ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)</li>
                <li><strong>DeepSeek API:</strong> <a href="https://platform.deepseek.com/" target="_blank">‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶ø‡¶®</a> (Music recommendation ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)</li>
            </ul>
        </div>

        <div class="input-section">
            <div class="form-group">
                <label for="location">üìç ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® (‡¶∂‡¶π‡¶∞/‡¶è‡¶≤‡¶æ‡¶ï‡¶æ):</label>
                <input type="text" id="location" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶¢‡¶æ‡¶ï‡¶æ, ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂" value="Dhaka, Bangladesh">
            </div>

            <div class="form-group">
                <label for="mood">üòä ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶Æ‡ßÅ‡¶°:</label>
                <select id="mood">
                    <option value="happy">üòä Happy - ‡¶ñ‡ßÅ‡¶∂‡¶ø</option>
                    <option value="sad">üòî Sad - ‡¶¶‡ßÅ‡¶É‡¶ñ</option>
                    <option value="relaxed">üòå Relaxed - ‡¶∞‡¶ø‡¶≤‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏</option>
                    <option value="energetic">‚ö° Energetic - ‡¶è‡¶®‡¶æ‡¶∞‡ßç‡¶ú‡ßá‡¶ü‡¶ø‡¶ï</option>
                    <option value="romantic">üíñ Romantic - ‡¶∞‡ßã‡¶Æ‡¶æ‡¶®‡ßç‡¶ü‡¶ø‡¶ï</option>
                    <option value="focused">üéØ Focused - ‡¶´‡ßã‡¶ï‡¶æ‡¶∏‡¶°</option>
                    <option value="nostalgic">üì∏ Nostalgic - ‡¶®‡¶∏‡ßç‡¶ü‡¶æ‡¶≤‡¶ú‡¶ø‡¶ï</option>
                </select>
            </div>

            <div class="form-group">
                <label for="additionalContext">üìù ‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ (‡¶Ø‡¶¶‡¶ø ‡¶•‡¶æ‡¶ï‡ßá):</label>
                <textarea id="additionalContext" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶∞‡ßá‡¶á‡¶®‡¶ø ‡¶¶‡¶ø‡¶®, ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶Æ‡¶® ‡¶ñ‡¶æ‡¶∞‡¶æ‡¶™... ‡¶¨‡¶æ ‡¶Ö‡¶´‡¶ø‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶´‡¶ø‡¶∞‡ßá‡¶õ‡¶ø, ‡¶∞‡¶ø‡¶≤‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶á..."></textarea>
            </div>

            <div class="form-group">
                <label for="geminiApiKey">üå§Ô∏è Gemini API Key (Weather Analysis):</label>
                <input type="password" id="geminiApiKey" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Gemini API Key ‡¶¶‡¶ø‡¶®">
            </div>

            <div class="form-group">
                <label for="deepseekApiKey">ü§ñ DeepSeek API Key (Music Recommendation):</label>
                <input type="password" id="deepseekApiKey" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ DeepSeek API Key ‡¶¶‡¶ø‡¶®">
            </div>

            <button class="btn" onclick="getMusicRecommendations()">üéµ ‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï ‡¶∞‡¶ø‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶°‡ßá‡¶∂‡¶® ‡¶®‡¶ø‡¶®</button>
        </div>

        <div class="error-message" id="errorMessage"></div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>‡¶Ü‡¶¨‡¶π‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá... ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßÅ‡¶° ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶≤‡¶æ‡¶á‡¶∏‡¶ø‡¶∏ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá... ‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
        </div>

        <div class="result-section" id="resultSection">
            <h2>üé∂ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∞‡¶ø‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶°‡ßá‡¶° ‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï</h2>
            
            <div class="weather-analysis" id="weatherAnalysis" style="display: none;">
                <!-- Weather analysis will be shown here -->
            </div>
            
            <div class="music-list" id="musicList">
                <!-- Music items will be added here dynamically -->
            </div>
        </div>
    </div>

    <script>
        async function getMusicRecommendations() {
            // Show loading, hide previous results and errors
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('weatherAnalysis').style.display = 'none';

            // Get user inputs
            const location = document.getElementById('location').value;
            const mood = document.getElementById('mood').value;
            const additionalContext = document.getElementById('additionalContext').value;
            const GEMINI_API_KEY = document.getElementById('geminiApiKey').value;
            const DEEPSEEK_API_KEY = document.getElementById('deepseekApiKey').value;

            // Validate API keys
            if (!GEMINI_API_KEY || !DEEPSEEK_API_KEY) {
                showError('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶â‡¶≠‡¶Ø‡¶º API Key ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                document.getElementById('loading').style.display = 'none';
                return;
            }

            if (!location) {
                showError('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§');
                document.getElementById('loading').style.display = 'none';
                return;
            }

            try {
                // Step 1: Get detailed weather analysis using Gemini
                const weatherAnalysis = await getWeatherAnalysis(location, GEMINI_API_KEY);
                
                // Display weather analysis
                displayWeatherAnalysis(weatherAnalysis);
                
                // Step 2: Analyze mood and get music recommendations using DeepSeek
                const musicRecommendations = await analyzeMoodAndGetMusic(
                    mood, 
                    additionalContext, 
                    weatherAnalysis,
                    DEEPSEEK_API_KEY
                );

                // Step 3: Display music recommendations
                displayMusicList(musicRecommendations);

            } catch (error) {
                console.error('Error:', error);
                showError('‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ' + error.message);
            } finally {
                // Hide loading
                document.getElementById('loading').style.display = 'none';
            }
        }

        async function getWeatherAnalysis(location, apiKey) {
            try {
                const prompt = `
                    Location: ${location}
                    Current Date: ${new Date().toLocaleDateString('bn-BD')}
                    
                    Please provide detailed weather analysis for this location including:
                    1. Current temperature and weather condition
                    2. Temperature trends (rising/falling/stable)
                    3. Comparison with previous days
                    4. Weather patterns and variations
                    5. Any notable weather events
                    6. Overall weather impact on mood
                    
                    Return as a JSON object with this exact structure:
                    {
                        "location": "city name",
                        "current_temp": "current temperature",
                        "condition": "weather condition",
                        "trend": "temperature trend description",
                        "comparison": "comparison with previous days",
                        "patterns": "weather patterns description", 
                        "impact": "weather impact on mood",
                        "summary": "overall weather summary"
                    }
                    
                    Make the response in Bengali where appropriate.
                `;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 1000,
                        }
                    })
                });

                if (!response.ok) {
                    if (response.status === 400) {
                        throw new Error('Invalid Gemini API Key - ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï API Key ‡¶¶‡¶ø‡¶®');
                    } else if (response.status === 429) {
                        throw new Error('API Limit exceeded - ‡¶™‡¶∞‡ßá ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®');
                    } else {
                        throw new Error('Gemini API ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
                    }
                }

                const data = await response.json();
                
                if (!data.candidates || !data.candidates[0].content.parts[0].text) {
                    throw new Error('Gemini response format is invalid');
                }

                const content = data.candidates[0].content.parts[0].text;
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                } else {
                    // Fallback weather data if JSON parsing fails
                    return getFallbackWeatherData(location);
                }
            } catch (error) {
                console.error('Weather Analysis Error:', error);
                return getFallbackWeatherData(location);
            }
        }

        function getFallbackWeatherData(location) {
            // Simple fallback weather data
            const temperatures = [28, 29, 27, 30, 26, 31, 29];
            const currentTemp = temperatures[Math.floor(Math.random() * temperatures.length)];
            const trends = ['‡¶∏‡ßç‡¶•‡¶ø‡¶§‡¶ø‡¶∂‡ßÄ‡¶≤', '‡¶¨‡ßÉ‡¶¶‡ßç‡¶ß‡¶ø ‡¶™‡¶æ‡¶ö‡ßç‡¶õ‡ßá', '‡¶π‡ßç‡¶∞‡¶æ‡¶∏ ‡¶™‡¶æ‡¶ö‡ßç‡¶õ‡ßá'];
            const conditions = ['‡¶∞‡ßå‡¶¶‡ßç‡¶∞‡ßã‡¶ú‡ßç‡¶ú‡ßç‡¶¨‡¶≤', '‡¶Æ‡ßá‡¶ò‡¶≤‡¶æ', '‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶¨‡ßÉ‡¶∑‡ßç‡¶ü‡¶ø', '‡¶Ü‡¶¶‡ßç‡¶∞'];
            
            return {
                location: location,
                current_temp: `${currentTemp}¬∞C`,
                condition: conditions[Math.floor(Math.random() * conditions.length)],
                trend: trends[Math.floor(Math.random() * trends.length)],
                comparison: `‡¶ó‡¶§ ‡ß© ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶§‡ßÅ‡¶≤‡¶®‡¶æ‡¶Ø‡¶º ${currentTemp > 28 ? '‡¶ó‡¶∞‡¶Æ' : '‡¶∂‡ßÄ‡¶§‡¶≤'}`,
                patterns: "‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶¶‡¶ø‡¶®‡¶ó‡ßÅ‡¶≤‡ßã‡¶§‡ßá ‡¶§‡¶æ‡¶™‡¶Æ‡¶æ‡¶§‡ßç‡¶∞‡¶æ‡¶∞ ‡¶ì‡¶†‡¶æ‡¶®‡¶æ‡¶Æ‡¶æ ‡¶ö‡¶≤‡¶õ‡ßá",
                impact: "‡¶Ü‡¶¨‡¶π‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßÅ‡¶°‡¶ï‡ßá ‡¶™‡ßç‡¶∞‡¶≠‡¶æ‡¶¨‡¶ø‡¶§ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá",
                summary: `${location} ‡¶è ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶Ü‡¶¨‡¶π‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ${currentTemp}¬∞C ‡¶§‡¶æ‡¶™‡¶Æ‡¶æ‡¶§‡ßç‡¶∞‡¶æ ‡¶∏‡¶π ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£`
            };
        }

        function displayWeatherAnalysis(weatherData) {
            const weatherElement = document.getElementById('weatherAnalysis');
            
            weatherElement.innerHTML = `
                <h3>üå§Ô∏è ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶Ü‡¶¨‡¶π‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£</h3>
                
                <div class="weather-stats">
                    <div class="weather-stat">
                        <div class="value">${weatherData.current_temp}</div>
                        <div class="label">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶§‡¶æ‡¶™‡¶Æ‡¶æ‡¶§‡ßç‡¶∞‡¶æ</div>
                    </div>
                    <div class="weather-stat">
                        <div class="value">${weatherData.condition}</div>
                        <div class="label">‡¶Ü‡¶¨‡¶π‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</div>
                    </div>
                    <div class="weather-stat">
                        <div class="value">${weatherData.trend}</div>
                        <div class="label">‡¶§‡¶æ‡¶™‡¶Æ‡¶æ‡¶§‡ßç‡¶∞‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶¨‡¶£‡¶§‡¶æ</div>
                    </div>
                </div>
                
                <div style="margin-top: 15px;">
                    <p><strong>üìç ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®:</strong> ${weatherData.location}</p>
                    <p><strong>üìä ‡¶§‡ßÅ‡¶≤‡¶®‡¶æ:</strong> ${weatherData.comparison}</p>
                    <p><strong>üîç ‡¶™‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∞‡ßç‡¶®:</strong> ${weatherData.patterns}</p>
                    <p><strong>üí≠ ‡¶Æ‡ßÅ‡¶° ‡¶á‡¶Æ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü:</strong> ${weatherData.impact}</p>
                    <p><strong>üìù ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™:</strong> ${weatherData.summary}</p>
                </div>
            `;
            
            weatherElement.style.display = 'block';
        }

        async function analyzeMoodAndGetMusic(mood, context, weatherData, apiKey) {
            try {
                const prompt = `
                User Context Analysis:
                - User Mood: ${mood}
                - Additional Context: ${context || "None provided"}
                - Weather Analysis: 
                  * Location: ${weatherData.location}
                  * Temperature: ${weatherData.current_temp}
                  * Condition: ${weatherData.condition}
                  * Trend: ${weatherData.trend}
                  * Comparison: ${weatherData.comparison}
                  * Patterns: ${weatherData.patterns}
                  * Impact: ${weatherData.impact}
                - Time: ${new Date().toLocaleTimeString('bn-BD')}
                - Date: ${new Date().toLocaleDateString('bn-BD')}

                Based on this comprehensive context, recommend 6-8 specific songs that would perfectly match the user's current situation, mood, and weather conditions.
                Include songs from both YouTube and Spotify.

                Return format MUST be valid JSON array only, no other text:
                [
                    {
                        "title": "Song Name",
                        "artist": "Artist Name", 
                        "platform": "youtube/spotify",
                        "url": "song_name_artist_search_query",
                        "reason": "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶Ø‡¶º ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶ï‡ßá‡¶® ‡¶è‡¶á ‡¶ó‡¶æ‡¶® ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶Æ‡ßÅ‡¶° ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶¨‡¶π‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Æ‡¶æ‡¶®‡¶æ‡¶®‡¶∏‡¶á"
                    }
                ]

                Focus on popular Bengali/Indian and International songs that match the mood, weather, and context.
                Consider how weather affects mood and suggest appropriate music.
                `;

                const response = await fetch('https://api.deepseek.com/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [{ role: "user", content: prompt }],
                        max_tokens: 2000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    if (response.status === 401) {
                        throw new Error('Invalid DeepSeek API Key - ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï API Key ‡¶¶‡¶ø‡¶®');
                    } else {
                        throw new Error('DeepSeek API ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
                    }
                }

                const data = await response.json();
                
                if (!data.choices || !data.choices[0]) {
                    throw new Error('AI response format is invalid');
                }

                // Extract JSON from the response
                const content = data.choices[0].message.content;
                const jsonMatch = content.match(/\[[\s\S]*\]/);
                
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                } else {
                    throw new Error('AI could not generate proper music recommendations');
                }
            } catch (error) {
                console.error('AI Analysis Error:', error);
                // Return fallback music list
                return getFallbackMusicList(mood, weatherData);
            }
        }

        function displayMusicList(musicList) {
            const musicListElement = document.getElementById('musicList');
            musicListElement.innerHTML = '';

            if (!musicList || musicList.length === 0) {
                musicListElement.innerHTML = '<p>‡¶ï‡ßã‡¶®‡ßã ‡¶Æ‡¶ø‡¶â‡¶ú‡¶ø‡¶ï ‡¶∞‡¶ø‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶°‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>';
                document.getElementById('resultSection').style.display = 'block';
                return;
            }

            musicList.forEach((music, index) => {
                const musicItem = document.createElement('div');
                musicItem.className = 'music-item';
                musicItem.innerHTML = `
                    <div class="music-icon">
                        ${music.platform === 'youtube' ? 'üì∫' : 'üéµ'}
                    </div>
                    <div class="music-info">
                        <div class="music-title">${music.title} - ${music.artist}</div>
                        <div class="music-platform">${music.platform.toUpperCase()} ‚Ä¢ ${music.reason}</div>
                    </div>
                    <button class="play-btn" onclick="playMusic('${music.url.replace(/'/g, "\\'")}', '${music.platform}')">
                        Play
                    </button>
                `;
                musicListElement.appendChild(musicItem);
            });

            // Show result section
            document.getElementById('resultSection').style.display = 'block';
        }

        function playMusic(url, platform) {
            if (platform === 'youtube') {
                // Search on YouTube
                window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(url)}`, '_blank');
            } else if (platform === 'spotify') {
                // Search on Spotify
                window.open(`https://open.spotify.com/search/${encodeURIComponent(url)}`, '_blank');
            }
        }

        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }

        // Enhanced fallback music list with weather consideration
        function getFallbackMusicList(mood, weatherData) {
            const isRainy = weatherData.condition.includes('‡¶¨‡ßÉ‡¶∑‡ßç‡¶ü‡¶ø');
            const isHot = parseInt(weatherData.current_temp) > 30;
            const isCold = parseInt(weatherData.current_temp) < 20;

            const weatherContext = isRainy ? '‡¶¨‡ßÉ‡¶∑‡ßç‡¶ü‡¶ø‡¶∞ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø' : 
                                 isHot ? '‡¶ó‡¶∞‡¶Æ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø' :
                                 isCold ? '‡¶∂‡ßÄ‡¶§‡¶≤ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø' : '';

            const fallbackLists = {
                happy: [
                    {
                        title: "Uptown Funk",
                        artist: "Mark Ronson ft. Bruno Mars",
                        platform: "youtube",
                        url: "Uptown Funk Bruno Mars",
                        reason: `${weatherContext} ‡¶ñ‡ßÅ‡¶∂‡¶ø ‡¶Æ‡ßÅ‡¶°‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡¶æ‡¶∞‡¶´‡ßá‡¶ï‡ßç‡¶ü ‡¶è‡¶®‡¶æ‡¶∞‡ßç‡¶ú‡ßá‡¶ü‡¶ø‡¶ï ‡¶ó‡¶æ‡¶®`
                    },
                    {
                        title: "‡¶ö‡¶≤‡ßã ‡¶¨‡ßá‡¶°‡¶º‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ü‡¶∏‡¶ø",
                        artist: "‡¶ú‡ßá‡¶Æ‡¶∏",
                        platform: "youtube",
                        url: "‡¶ö‡¶≤‡ßã ‡¶¨‡ßá‡¶°‡¶º‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ü‡¶∏‡¶ø ‡¶ú‡ßá‡¶Æ‡¶∏",
                        reason: `${weatherContext} ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶π‡ßç‡¶Ø‡¶æ‡¶™‡¶ø ‡¶∏‡¶ô‡ßç‡¶ó‡ßÄ‡¶§`
                    }
                ],
                sad: [
                    {
                        title: "Someone Like You",
                        artist: "Adele",
                        platform: "youtube",
                        url: "Someone Like You Adele",
                        reason: `${weatherContext} ‡¶¶‡ßÅ‡¶É‡¶ñ ‡¶≠‡¶∞‡¶æ ‡¶Æ‡ßÅ‡¶°‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶Æ‡ßã‡¶∂‡¶®‡¶æ‡¶≤ ‡¶ó‡¶æ‡¶®`
                    }
                ],
                relaxed: [
                    {
                        title: "‡¶®‡ßÄ‡¶≤‡¶æ",
                        artist: "‡¶Ü‡¶Ø‡¶º‡¶® ‡¶¨‡¶®‡ßç‡¶¶‡ßç‡¶Ø‡ßã‡¶™‡¶æ‡¶ß‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º",
                        platform: "youtube",
                        url: "‡¶®‡ßÄ‡¶≤‡¶æ ‡¶Ü‡¶Ø‡¶º‡¶® ‡¶¨‡¶®‡ßç‡¶¶‡ßç‡¶Ø‡ßã‡¶™‡¶æ‡¶ß‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º",
                        reason: `${weatherContext} ‡¶∂‡¶æ‡¶®‡ßç‡¶§‡¶ø‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶ó‡¶æ‡¶®`
                    }
                ]
            };

            return fallbackLists[mood] || fallbackLists.happy;
        }

        // Enter key support for the form
        document.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                getMusicRecommendations();
            }
        });

        // Instructions for getting API keys
        console.log(`
API Keys ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø:
1. Gemini API: https://aistudio.google.com/app/apikey - Free tier ‡¶Ü‡¶õ‡ßá
2. DeepSeek API: https://platform.deepseek.com/ - Free credits ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶•‡¶æ‡¶ï‡ßá
        `);
    </script>
</body>
</html>